#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push checks..."

# Run full test suite
echo "🧪 Running full test suite..."
npm run test:cov

# Check test coverage threshold
echo "📊 Checking test coverage..."
coverage=$(npm run test:cov --silent | grep "All files" | awk '{print $10}' | sed 's/%//')
if [ "$coverage" -lt 80 ]; then
  echo "❌ Test coverage is below 80% ($coverage%)"
  echo "Please add more tests before pushing."
  exit 1
fi

# Run e2e tests
echo "🔄 Running e2e tests..."
npm run test:e2e

# Check for security vulnerabilities
echo "🔒 Checking for security vulnerabilities..."
npm audit --audit-level moderate

echo "✅ Pre-push checks passed!" 